!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).GSD={})}(this,(function(t){"use strict";function e(t,e){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{windowSize:s=9,derivative:i=0,polynomial:l=3}=o;if(s%2==0||s<5||!Number.isInteger(s))throw new RangeError("Invalid window size (should be odd and at least 5 integer number)");if(s>t.length)throw new RangeError("Window size is higher than the data length ".concat(s,">").concat(t.length));if(i<0||!Number.isInteger(i))throw new RangeError("Derivative should be a positive integer");if(l<1||!Number.isInteger(l))throw new RangeError("Polynomial should be a positive integer");l>=6&&console.warn("You should not use polynomial grade higher than 5 if you are not sure that your data arises from such a model. Possible polynomial oscillation problems");let h=Math.floor(s/2),u=t.length,a=new Array(u),f=function(t,e,r){let o=new Array(t),s=Math.floor(t/2);for(let i=-s;i<=s;i++){o[i+s]=new Array(t);for(let t=-s;t<=s;t++)o[i+s][t+s]=n(t,i,s,e,r)}return o}(s,l,i),c=0,m=!0;Array.isArray(e)?m=!1:c=Math.pow(e,i);for(let o=0;o<h;o++){let n=f[h-o-1],l=f[h+o+1],g=0,w=0;for(let e=0;e<s;e++)g+=n[e]*t[e],w+=l[e]*t[u-s+e];m?(a[h-o-1]=g/c,a[u-h+o]=w/c):(c=r(e,h-o-1,h,i),a[h-o-1]=g/c,c=r(e,u-h+o,h,i),a[u-h+o]=w/c)}let g=f[h];for(let o=s;o<=u;o++){let n=0;for(let e=0;e<s;e++)n+=g[e]*t[e+o-s];m||(c=r(e,o-h-1,h,i)),a[o-h-1]=n/c}return a}function r(t,e,r,o){let s=0,n=0;for(let o=e-r;o<e+r;o++)o>=0&&o<t.length-1&&(s+=t[o+1]-t[o],n++);return Math.pow(s/n,o)}function o(t,e,r,s){let n=0;return n=r>0?(4*r-2)/(r*(2*e-r+1))*(t*o(t,e,r-1,s)+s*o(t,e,r-1,s-1))-(r-1)*(2*e+r)/(r*(2*e-r+1))*o(t,e,r-2,s):0===r&&0===s?1:0,n}function s(t,e){let r=1;if(t>=e)for(let o=t-e+1;o<=t;o++)r*=o;return r}function n(t,e,r,n,i){let l=0;for(let h=0;h<=n;h++)l+=(2*h+1)*(s(2*r,h)/s(2*r+h+1,h+1))*o(t,r,h,0)*o(e,r,h,i);return l}const i=t=>{let e,r=0,o=Number.MAX_SAFE_INTEGER;for(let s=0;s<t.length-1;++s)e=Math.abs(t[s+1]-t[s]),e<o&&(o=e),e>r&&(r=e);return(r-o)/r<.05},l=t=>{let e=0,r=0,o=t.length;for(let r=0;r<o;++r)e+=t[r];e/=o;let s=new Array(o);for(let r=0;r<o;++r)s[r]=Math.abs(t[r]-e);return s.sort((t,e)=>t-e),r=o%2==1?s[(o-1)/2]/.6745:.5*(s[o/2]+s[o/2-1])/.6745,r},h=(t,e,r)=>{let o,s,n,i,l;for(let h=0;h<t.length;h++)l=t[h].index,r[l-1]>=r[l-2]&&r[l-1]>=r[l]?l--:r[l+1]>=r[l]&&r[l+1]>=r[l+2]?l++:r[l-2]>=r[l-3]&&r[l-2]>=r[l-1]?l-=2:r[l+2]>=r[l+1]&&r[l+2]>=r[l+3]&&(l+=2),r[l-1]>0&&r[l+1]>0&&r[l]>=r[l-1]&&r[l]>=r[l+1]&&(r[l]!==r[l-1]||r[l]!==r[l+1])&&(o=20*Math.log10(r[l-1]),s=20*Math.log10(r[l]),n=20*Math.log10(r[l+1]),i=.5*(o-n)/(o-2*s+n),t[h].x=e[l]+(e[l]-e[l-1])*i,t[h].y=r[l]-.25*(r[l-1]-r[l+1])*i)},u=Object.prototype.toString;function a(t){return u.call(t).endsWith("Array]")}function f(t,e,r){let o=0;const s=r(e);for(let e=0;e<t.x.length;e++)o+=Math.abs(t.y[e]-s(t.x[e]));return o}const c=Object.prototype.toString;var m=function(t){return c.call(t).endsWith("Array]")};const g=Object.prototype.toString;var w=function(t){return g.call(t).endsWith("Array]")};const p=Object.prototype.toString;var d=function(t){return p.call(t).endsWith("Array]")};function y(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!m(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");if(void 0!==r.output){if(!m(r.output))throw new TypeError("output option must be an array if specified");e=r.output}else e=new Array(t.length);var o=function(t){if(!d(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var e=t[0],r=1;r<t.length;r++)t[r]<e&&(e=t[r]);return e}(t),s=function(t){if(!w(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var e=t[0],r=1;r<t.length;r++)t[r]>e&&(e=t[r]);return e}(t);if(o===s)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var n=r.min,i=void 0===n?r.autoMinMax?o:0:n,l=r.max,h=void 0===l?r.autoMinMax?s:1:l;if(i>=h)throw new RangeError("min option must be smaller than max option");for(var u=(h-i)/(s-o),a=0;a<t.length;a++)e[a]=(t[a]-o)*u+i;return e}const b=" ".repeat(2),M=" ".repeat(4);function x(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{maxRows:r=15,maxColumns:o=10,maxNumSize:s=8}=e;return"".concat(t.constructor.name," {\n").concat(b,"[\n").concat(M).concat(function(t,e,r,o){const{rows:s,columns:n}=t,i=Math.min(s,e),l=Math.min(n,r),h=[];for(let e=0;e<i;e++){let r=[];for(let s=0;s<l;s++)r.push(v(t.get(e,s),o));h.push("".concat(r.join(" ")))}l!==n&&(h[h.length-1]+=" ... ".concat(n-r," more columns"));i!==s&&h.push("... ".concat(s-e," more rows"));return h.join("\n".concat(M))}(t,r,o,s),"\n").concat(b,"]\n").concat(b,"rows: ").concat(t.rows,"\n").concat(b,"columns: ").concat(t.columns,"\n}")}function v(t,e){const r=String(t);if(r.length<=e)return r.padEnd(e," ");const o=t.toPrecision(e-2);if(o.length<=e)return o;const s=t.toExponential(e-2),n=s.indexOf("e"),i=s.slice(n);return s.slice(0,e-i.length)+i}function E(t,e,r){let o=r?t.rows:t.rows-1;if(e<0||e>o)throw new RangeError("Row index out of range")}function S(t,e,r){let o=r?t.columns:t.columns-1;if(e<0||e>o)throw new RangeError("Column index out of range")}function A(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function R(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function V(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for row indices");if(e.some(e=>e<0||e>=t.rows))throw new RangeError("row indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function T(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for column indices");if(e.some(e=>e<0||e>=t.columns))throw new RangeError("column indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function k(t,e,r,o,s){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(N("startRow",e),N("endRow",r),N("startColumn",o),N("endColumn",s),e>r||o>s||e<0||e>=t.rows||r<0||r>=t.rows||o<0||o>=t.columns||s<0||s>=t.columns)throw new RangeError("Submatrix indices are out of range")}function F(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=[];for(let o=0;o<t;o++)r.push(e);return r}function N(t,e){if("number"!=typeof e)throw new TypeError("".concat(t," must be a number"))}class z{static from1DArray(t,e,r){if(t*e!==r.length)throw new RangeError("data length does not match given dimensions");let o=new j(t,e);for(let s=0;s<t;s++)for(let t=0;t<e;t++)o.set(s,t,r[s*e+t]);return o}static rowVector(t){let e=new j(1,t.length);for(let r=0;r<t.length;r++)e.set(0,r,t[r]);return e}static columnVector(t){let e=new j(t.length,1);for(let r=0;r<t.length;r++)e.set(r,0,t[r]);return e}static zeros(t,e){return new j(t,e)}static ones(t,e){return new j(t,e).fill(1)}static rand(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("object"!=typeof r)throw new TypeError("options must be an object");const{random:o=Math.random}=r;let s=new j(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++)s.set(r,t,o());return s}static randInt(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("object"!=typeof r)throw new TypeError("options must be an object");const{min:o=0,max:s=1e3,random:n=Math.random}=r;if(!Number.isInteger(o))throw new TypeError("min must be an integer");if(!Number.isInteger(s))throw new TypeError("max must be an integer");if(o>=s)throw new RangeError("min must be smaller than max");let i=s-o,l=new j(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++){let e=o+Math.round(n()*i);l.set(r,t,e)}return l}static eye(t,e,r){void 0===e&&(e=t),void 0===r&&(r=1);let o=Math.min(t,e),s=this.zeros(t,e);for(let t=0;t<o;t++)s.set(t,t,r);return s}static diag(t,e,r){let o=t.length;void 0===e&&(e=o),void 0===r&&(r=e);let s=Math.min(o,e,r),n=this.zeros(e,r);for(let e=0;e<s;e++)n.set(e,e,t[e]);return n}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,o=t.columns,s=new j(r,o);for(let n=0;n<r;n++)for(let r=0;r<o;r++)s.set(n,r,Math.min(t.get(n,r),e.get(n,r)));return s}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,o=t.columns,s=new this(r,o);for(let n=0;n<r;n++)for(let r=0;r<o;r++)s.set(n,r,Math.max(t.get(n,r),e.get(n,r)));return s}static checkMatrix(t){return z.isMatrix(t)?t:new j(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.call(this,e,r);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.push(this.get(e,r));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let r=0;r<this.columns;r++)t[e].push(this.get(e,r))}return t}toJSON(){return this.to2DArray()}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isEchelonForm(){let t=0,e=0,r=-1,o=!0,s=!1;for(;t<this.rows&&o;){for(e=0,s=!1;e<this.columns&&!1===s;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(s=!0,r=e):(o=!1,s=!0);t++}return o}isReducedEchelonForm(){let t=0,e=0,r=-1,o=!0,s=!1;for(;t<this.rows&&o;){for(e=0,s=!1;e<this.columns&&!1===s;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(s=!0,r=e):(o=!1,s=!0);for(let r=e+1;r<this.rows;r++)0!==this.get(t,r)&&(o=!1);t++}return o}echelonForm(){let t=this.clone(),e=0,r=0;for(;e<t.rows&&r<t.columns;){let o=e;for(let s=e;s<t.rows;s++)t.get(s,r)>t.get(o,r)&&(o=s);if(0===t.get(o,r))r++;else{t.swapRows(e,o);let s=t.get(e,r);for(let o=r;o<t.columns;o++)t.set(e,o,t.get(e,o)/s);for(let o=e+1;o<t.rows;o++){let s=t.get(o,r)/t.get(e,r);t.set(o,r,0);for(let n=r+1;n<t.columns;n++)t.set(o,n,t.get(o,n)-t.get(e,n)*s)}e++,r++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,r=t.rows,o=r-1;for(;o>=0;)if(0===t.maxRow(o))o--;else{let s=0,n=!1;for(;s<r&&!1===n;)1===t.get(o,s)?n=!0:s++;for(let r=0;r<o;r++){let n=t.get(r,s);for(let i=s;i<e;i++){let e=t.get(r,i)-n*t.get(o,i);t.set(r,i,e)}}o--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("object"!=typeof t)throw new TypeError("options must be an object");const{rows:e=1,columns:r=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new TypeError("columns must be a positive integer");let o=new j(this.rows*e,this.columns*r);for(let t=0;t<e;t++)for(let e=0;e<r;e++)o.setSubMatrix(this,this.rows*t,this.columns*e);return o}fill(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,t);return this}neg(){return this.mulS(-1)}getRow(t){E(this,t);let e=[];for(let r=0;r<this.columns;r++)e.push(this.get(t,r));return e}getRowVector(t){return j.rowVector(this.getRow(t))}setRow(t,e){E(this,t),e=A(this,e);for(let r=0;r<this.columns;r++)this.set(t,r,e[r]);return this}swapRows(t,e){E(this,t),E(this,e);for(let r=0;r<this.columns;r++){let o=this.get(t,r);this.set(t,r,this.get(e,r)),this.set(e,r,o)}return this}getColumn(t){S(this,t);let e=[];for(let r=0;r<this.rows;r++)e.push(this.get(r,t));return e}getColumnVector(t){return j.columnVector(this.getColumn(t))}setColumn(t,e){S(this,t),e=R(this,e);for(let r=0;r<this.rows;r++)this.set(r,t,e[r]);return this}swapColumns(t,e){S(this,t),S(this,e);for(let r=0;r<this.rows;r++){let o=this.get(r,t);this.set(r,t,this.get(r,e)),this.set(r,e,o)}return this}addRowVector(t){t=A(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[r]);return this}subRowVector(t){t=A(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[r]);return this}mulRowVector(t){t=A(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[r]);return this}divRowVector(t){t=A(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[r]);return this}addColumnVector(t){t=R(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[e]);return this}subColumnVector(t){t=R(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[e]);return this}mulColumnVector(t){t=R(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[e]);return this}divColumnVector(t){t=R(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[e]);return this}mulRow(t,e){E(this,t);for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e);return this}mulColumn(t,e){S(this,t);for(let r=0;r<this.rows;r++)this.set(r,t,this.get(r,t)*e);return this}max(){let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)>t&&(t=this.get(e,r));return t}maxIndex(){let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)>t&&(t=this.get(r,o),e[0]=r,e[1]=o);return e}min(){let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)<t&&(t=this.get(e,r));return t}minIndex(){let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)<t&&(t=this.get(r,o),e[0]=r,e[1]=o);return e}maxRow(t){E(this,t);let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxRowIndex(t){E(this,t);let e=this.get(t,0),r=[t,0];for(let o=1;o<this.columns;o++)this.get(t,o)>e&&(e=this.get(t,o),r[1]=o);return r}minRow(t){E(this,t);let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r));return e}minRowIndex(t){E(this,t);let e=this.get(t,0),r=[t,0];for(let o=1;o<this.columns;o++)this.get(t,o)<e&&(e=this.get(t,o),r[1]=o);return r}maxColumn(t){S(this,t);let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxColumnIndex(t){S(this,t);let e=this.get(0,t),r=[0,t];for(let o=1;o<this.rows;o++)this.get(o,t)>e&&(e=this.get(o,t),r[0]=o);return r}minColumn(t){S(this,t);let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t));return e}minColumnIndex(t){S(this,t);let e=this.get(0,t),r=[0,t];for(let o=1;o<this.rows;o++)this.get(o,t)<e&&(e=this.get(o,t),r[0]=o);return r}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let r=0;r<t;r++)e.push(this.get(r,r));return e}norm(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"frobenius",e=0;if("max"===t)return this.max();if("frobenius"===t){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e+=this.get(t,r)*this.get(t,r);return Math.sqrt(e)}throw new RangeError("unknown norm type: ".concat(t))}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t+=this.get(e,r),this.set(e,r,t);return this}dot(t){z.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let r=0;for(let o=0;o<e.length;o++)r+=e[o]*t[o];return r}mmul(t){t=j.checkMatrix(t);let e=this.rows,r=this.columns,o=t.columns,s=new j(e,o),n=new Float64Array(r);for(let i=0;i<o;i++){for(let e=0;e<r;e++)n[e]=t.get(e,i);for(let t=0;t<e;t++){let e=0;for(let o=0;o<r;o++)e+=this.get(t,o)*n[o];s.set(t,i,e)}}return s}strassen2x2(t){t=j.checkMatrix(t);let e=new j(2,2);const r=this.get(0,0),o=t.get(0,0),s=this.get(0,1),n=t.get(0,1),i=this.get(1,0),l=t.get(1,0),h=this.get(1,1),u=t.get(1,1),a=(r+h)*(o+u),f=(i+h)*o,c=r*(n-u),m=h*(l-o),g=(r+s)*u,w=a+m-g+(s-h)*(l+u),p=c+g,d=f+m,y=a-f+c+(i-r)*(o+n);return e.set(0,0,w),e.set(0,1,p),e.set(1,0,d),e.set(1,1,y),e}strassen3x3(t){t=j.checkMatrix(t);let e=new j(3,3);const r=this.get(0,0),o=this.get(0,1),s=this.get(0,2),n=this.get(1,0),i=this.get(1,1),l=this.get(1,2),h=this.get(2,0),u=this.get(2,1),a=this.get(2,2),f=t.get(0,0),c=t.get(0,1),m=t.get(0,2),g=t.get(1,0),w=t.get(1,1),p=t.get(1,2),d=t.get(2,0),y=t.get(2,1),b=t.get(2,2),M=(r-n)*(-c+w),x=(-r+n+i)*(f-c+w),v=(n+i)*(-f+c),E=r*f,S=(-r+h+u)*(f-m+p),A=(-r+h)*(m-p),R=(h+u)*(-f+m),V=(-s+u+a)*(w+d-y),T=(s-a)*(w-y),k=s*d,F=(u+a)*(-d+y),N=(-s+i+l)*(p+d-b),z=(s-l)*(p-b),I=(i+l)*(-d+b),C=E+k+o*g,q=(r+o+s-n-i-u-a)*w+x+v+E+V+k+F,D=E+S+R+(r+o+s-i-l-h-u)*p+k+N+I,P=M+i*(-f+c+g-w-p-d+b)+x+E+k+N+z,L=M+x+v+E+l*y,O=k+N+z+I+n*m,U=E+S+A+u*(-f+m+g-w-p-d+y)+V+T+k,_=V+T+k+F+h*c,W=E+S+A+R+a*b;return e.set(0,0,C),e.set(0,1,q),e.set(0,2,D),e.set(1,0,P),e.set(1,1,L),e.set(1,2,O),e.set(2,0,U),e.set(2,1,_),e.set(2,2,W),e}mmulStrassen(t){t=j.checkMatrix(t);let e=this.clone(),r=e.rows,o=e.columns,s=t.rows,n=t.columns;function i(t,e,r){let o=t.rows,s=t.columns;if(o===e&&s===r)return t;{let o=z.zeros(e,r);return o=o.setSubMatrix(t,0,0),o}}o!==s&&console.warn("Multiplying ".concat(r," x ").concat(o," and ").concat(s," x ").concat(n," matrix: dimensions do not match."));let l=Math.max(r,s),h=Math.max(o,n);return e=i(e,l,h),function t(e,r,o,s){if(o<=512||s<=512)return e.mmul(r);o%2==1&&s%2==1?(e=i(e,o+1,s+1),r=i(r,o+1,s+1)):o%2==1?(e=i(e,o+1,s),r=i(r,o+1,s)):s%2==1&&(e=i(e,o,s+1),r=i(r,o,s+1));let n=parseInt(e.rows/2,10),l=parseInt(e.columns/2,10),h=e.subMatrix(0,n-1,0,l-1),u=r.subMatrix(0,n-1,0,l-1),a=e.subMatrix(0,n-1,l,e.columns-1),f=r.subMatrix(0,n-1,l,r.columns-1),c=e.subMatrix(n,e.rows-1,0,l-1),m=r.subMatrix(n,r.rows-1,0,l-1),g=e.subMatrix(n,e.rows-1,l,e.columns-1),w=r.subMatrix(n,r.rows-1,l,r.columns-1),p=t(z.add(h,g),z.add(u,w),n,l),d=t(z.add(c,g),u,n,l),y=t(h,z.sub(f,w),n,l),b=t(g,z.sub(m,u),n,l),M=t(z.add(h,a),w,n,l),x=t(z.sub(c,h),z.add(u,f),n,l),v=t(z.sub(a,g),z.add(m,w),n,l),E=z.add(p,b);E.sub(M),E.add(v);let S=z.add(y,M),A=z.add(d,b),R=z.sub(p,d);R.add(y),R.add(x);let V=z.zeros(2*E.rows,2*E.columns);return V=V.setSubMatrix(E,0,0),V=V.setSubMatrix(S,E.rows,0),V=V.setSubMatrix(A,0,E.columns),V=V.setSubMatrix(R,E.rows,E.columns),V.subMatrix(0,o-1,0,s-1)}(e,t=i(t,l,h),l,h)}scaleRows(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let o=new j(this.rows,this.columns);for(let t=0;t<this.rows;t++){const s=this.getRow(t);y(s,{min:e,max:r,output:s}),o.setRow(t,s)}return o}scaleColumns(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let o=new j(this.rows,this.columns);for(let t=0;t<this.columns;t++){const s=this.getColumn(t);y(s,{min:e,max:r,output:s}),o.setColumn(t,s)}return o}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let r=0;r<t;r++){let t=this.get(e,r),o=this.get(e,this.columns-1-r);this.set(e,r,o),this.set(e,this.columns-1-r,t)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let r=0;r<t;r++){let t=this.get(r,e),o=this.get(this.rows-1-r,e);this.set(r,e,o),this.set(this.rows-1-r,e,t)}return this}kroneckerProduct(t){t=j.checkMatrix(t);let e=this.rows,r=this.columns,o=t.rows,s=t.columns,n=new j(e*o,r*s);for(let i=0;i<e;i++)for(let e=0;e<r;e++)for(let r=0;r<o;r++)for(let l=0;l<s;l++)n.set(o*i+r,s*e+l,this.get(i,e)*t.get(r,l));return n}transpose(){let t=new j(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(r,e,this.get(e,r));return t}sortRows(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I;for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I;for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,r,o){k(this,t,e,r,o);let s=new j(e-t+1,o-r+1);for(let n=t;n<=e;n++)for(let e=r;e<=o;e++)s.set(n-t,e-r,this.get(n,e));return s}subMatrixRow(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.columns-1),e>r||e<0||e>=this.columns||r<0||r>=this.columns)throw new RangeError("Argument out of range");let o=new j(t.length,r-e+1);for(let s=0;s<t.length;s++)for(let n=e;n<=r;n++){if(t[s]<0||t[s]>=this.rows)throw new RangeError("Row index out of range: ".concat(t[s]));o.set(s,n-e,this.get(t[s],n))}return o}subMatrixColumn(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.rows-1),e>r||e<0||e>=this.rows||r<0||r>=this.rows)throw new RangeError("Argument out of range");let o=new j(r-e+1,t.length);for(let s=0;s<t.length;s++)for(let n=e;n<=r;n++){if(t[s]<0||t[s]>=this.columns)throw new RangeError("Column index out of range: ".concat(t[s]));o.set(n-e,s,this.get(n,t[s]))}return o}setSubMatrix(t,e,r){k(this,e,e+(t=j.checkMatrix(t)).rows-1,r,r+t.columns-1);for(let o=0;o<t.rows;o++)for(let s=0;s<t.columns;s++)this.set(e+o,r+s,t.get(o,s));return this}selection(t,e){let r=function(t,e,r){return{row:V(t,e),column:T(t,r)}}(this,t,e),o=new j(t.length,e.length);for(let t=0;t<r.row.length;t++){let e=r.row[t];for(let s=0;s<r.column.length;s++){let n=r.column[s];o.set(t,s,this.get(e,n))}}return o}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let r=0;r<t;r++)e+=this.get(r,r);return e}clone(){let t=new j(this.rows,this.columns);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(e,r,this.get(e,r));return t}sum(t){switch(t){case"row":return function(t){let e=F(t.rows);for(let r=0;r<t.rows;++r)for(let o=0;o<t.columns;++o)e[r]+=t.get(r,o);return e}(this);case"column":return function(t){let e=F(t.columns);for(let r=0;r<t.rows;++r)for(let o=0;o<t.columns;++o)e[o]+=t.get(r,o);return e}(this);case void 0:return function(t){let e=0;for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)e+=t.get(r,o);return e}(this);default:throw new Error("invalid option: ".concat(t))}}product(t){switch(t){case"row":return function(t){let e=F(t.rows,1);for(let r=0;r<t.rows;++r)for(let o=0;o<t.columns;++o)e[r]*=t.get(r,o);return e}(this);case"column":return function(t){let e=F(t.columns,1);for(let r=0;r<t.rows;++r)for(let o=0;o<t.columns;++o)e[o]*=t.get(r,o);return e}(this);case void 0:return function(t){let e=1;for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)e*=t.get(r,o);return e}(this);default:throw new Error("invalid option: ".concat(t))}}mean(t){const e=this.sum(t);switch(t){case"row":for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e;case"column":for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e;case void 0:return e/this.size;default:throw new Error("invalid option: ".concat(t))}}variance(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{unbiased:r=!0,mean:o=this.mean(t)}=e;if("boolean"!=typeof r)throw new TypeError("unbiased must be a boolean");switch(t){case"row":if(!Array.isArray(o))throw new TypeError("mean must be an array");return function(t,e,r){const o=t.rows,s=t.columns,n=[];for(let i=0;i<o;i++){let o=0,l=0,h=0;for(let e=0;e<s;e++)h=t.get(i,e)-r[i],o+=h,l+=h*h;e?n.push((l-o*o/s)/(s-1)):n.push((l-o*o/s)/s)}return n}(this,r,o);case"column":if(!Array.isArray(o))throw new TypeError("mean must be an array");return function(t,e,r){const o=t.rows,s=t.columns,n=[];for(let i=0;i<s;i++){let s=0,l=0,h=0;for(let e=0;e<o;e++)h=t.get(e,i)-r[i],s+=h,l+=h*h;e?n.push((l-s*s/o)/(o-1)):n.push((l-s*s/o)/o)}return n}(this,r,o);case void 0:if("number"!=typeof o)throw new TypeError("mean must be a number");return function(t,e,r){const o=t.rows,s=t.columns,n=o*s;let i=0,l=0,h=0;for(let e=0;e<o;e++)for(let o=0;o<s;o++)h=t.get(e,o)-r,i+=h,l+=h*h;return e?(l-i*i/n)/(n-1):(l-i*i/n)/n}(this,r,o);default:throw new Error("invalid option: ".concat(t))}}standardDeviation(t,e){"object"==typeof t&&(e=t,t=void 0);const r=this.variance(t,e);if(void 0===t)return Math.sqrt(r);for(let t=0;t<r.length;t++)r[t]=Math.sqrt(r[t]);return r}center(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{center:r=this.mean(t)}=e;switch(t){case"row":if(!Array.isArray(r))throw new TypeError("center must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)-e[r])}(this,r),this;case"column":if(!Array.isArray(r))throw new TypeError("center must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)-e[o])}(this,r),this;case void 0:if("number"!=typeof r)throw new TypeError("center must be a number");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)-e)}(this,r),this;default:throw new Error("invalid option: ".concat(t))}}scale(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");let r=e.scale;switch(t){case"row":if(void 0===r)r=function(t){const e=[];for(let r=0;r<t.rows;r++){let o=0;for(let e=0;e<t.columns;e++)o+=Math.pow(t.get(r,e),2)/(t.columns-1);e.push(Math.sqrt(o))}return e}(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)/e[r])}(this,r),this;case"column":if(void 0===r)r=function(t){const e=[];for(let r=0;r<t.columns;r++){let o=0;for(let e=0;e<t.rows;e++)o+=Math.pow(t.get(e,r),2)/(t.rows-1);e.push(Math.sqrt(o))}return e}(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)/e[o])}(this,r),this;case void 0:if(void 0===r)r=function(t){const e=t.size-1;let r=0;for(let o=0;o<t.columns;o++)for(let s=0;s<t.rows;s++)r+=Math.pow(t.get(s,o),2)/e;return Math.sqrt(r)}(this);else if("number"!=typeof r)throw new TypeError("scale must be a number");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)/e)}(this,r),this;default:throw new Error("invalid option: ".concat(t))}}toString(t){return x(this,t)}}function I(t,e){return t-e}z.prototype.klass="Matrix","undefined"!=typeof Symbol&&(z.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return x(this)}),z.random=z.rand,z.randomInt=z.randInt,z.diagonal=z.diag,z.prototype.diagonal=z.prototype.diag,z.identity=z.eye,z.prototype.negate=z.prototype.neg,z.prototype.tensorProduct=z.prototype.kroneckerProduct;class j extends z{constructor(t,e){if(super(),j.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>0){if(this.data=[],!(Number.isInteger(e)&&e>0))throw new TypeError("nColumns must be a positive integer");for(let r=0;r<t;r++)this.data.push(new Float64Array(e))}else{if(!Array.isArray(t))throw new TypeError("First argument must be a positive number or an array");{const r=t;if(t=r.length,"number"!=typeof(e=r[0].length)||0===e)throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let o=0;o<t;o++){if(r[o].length!==e)throw new RangeError("Inconsistent array dimensions");this.data.push(Float64Array.from(r[o]))}}}return this.rows=t,this.columns=e,this}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}removeRow(t){if(E(this,t),1===this.rows)throw new RangeError("A matrix cannot have less than one row");return this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return void 0===e&&(e=t,t=this.rows),E(this,t,!0),e=Float64Array.from(A(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){if(S(this,t),1===this.columns)throw new RangeError("A matrix cannot have less than one column");for(let e=0;e<this.rows;e++){const r=new Float64Array(this.columns-1);for(let o=0;o<t;o++)r[o]=this.data[e][o];for(let o=t+1;o<this.columns;o++)r[o-1]=this.data[e][o];this.data[e]=r}return this.columns-=1,this}addColumn(t,e){void 0===e&&(e=t,t=this.columns),S(this,t,!0),e=R(this,e);for(let r=0;r<this.rows;r++){const o=new Float64Array(this.columns+1);let s=0;for(;s<t;s++)o[s]=this.data[r][s];for(o[s++]=e[r];s<this.columns+1;s++)o[s]=this.data[r][s-1];this.data[r]=o}return this.columns+=1,this}}!function(t,e){t.prototype.add=function(t){return"number"==typeof t?this.addS(t):this.addM(t)},t.prototype.addS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t);return this},t.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t.get(e,r));return this},t.add=function(t,r){return new e(t).add(r)},t.prototype.sub=function(t){return"number"==typeof t?this.subS(t):this.subM(t)},t.prototype.subS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t);return this},t.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t.get(e,r));return this},t.sub=function(t,r){return new e(t).sub(r)},t.prototype.subtract=t.prototype.sub,t.prototype.subtractS=t.prototype.subS,t.prototype.subtractM=t.prototype.subM,t.subtract=t.sub,t.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):this.mulM(t)},t.prototype.mulS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t);return this},t.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t.get(e,r));return this},t.mul=function(t,r){return new e(t).mul(r)},t.prototype.multiply=t.prototype.mul,t.prototype.multiplyS=t.prototype.mulS,t.prototype.multiplyM=t.prototype.mulM,t.multiply=t.mul,t.prototype.div=function(t){return"number"==typeof t?this.divS(t):this.divM(t)},t.prototype.divS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t);return this},t.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t.get(e,r));return this},t.div=function(t,r){return new e(t).div(r)},t.prototype.divide=t.prototype.div,t.prototype.divideS=t.prototype.divS,t.prototype.divideM=t.prototype.divM,t.divide=t.div,t.prototype.mod=function(t){return"number"==typeof t?this.modS(t):this.modM(t)},t.prototype.modS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t);return this},t.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t.get(e,r));return this},t.mod=function(t,r){return new e(t).mod(r)},t.prototype.modulus=t.prototype.mod,t.prototype.modulusS=t.prototype.modS,t.prototype.modulusM=t.prototype.modM,t.modulus=t.mod,t.prototype.and=function(t){return"number"==typeof t?this.andS(t):this.andM(t)},t.prototype.andS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t);return this},t.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t.get(e,r));return this},t.and=function(t,r){return new e(t).and(r)},t.prototype.or=function(t){return"number"==typeof t?this.orS(t):this.orM(t)},t.prototype.orS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t);return this},t.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t.get(e,r));return this},t.or=function(t,r){return new e(t).or(r)},t.prototype.xor=function(t){return"number"==typeof t?this.xorS(t):this.xorM(t)},t.prototype.xorS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t);return this},t.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t.get(e,r));return this},t.xor=function(t,r){return new e(t).xor(r)},t.prototype.leftShift=function(t){return"number"==typeof t?this.leftShiftS(t):this.leftShiftM(t)},t.prototype.leftShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t);return this},t.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t.get(e,r));return this},t.leftShift=function(t,r){return new e(t).leftShift(r)},t.prototype.signPropagatingRightShift=function(t){return"number"==typeof t?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},t.prototype.signPropagatingRightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t);return this},t.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t.get(e,r));return this},t.signPropagatingRightShift=function(t,r){return new e(t).signPropagatingRightShift(r)},t.prototype.rightShift=function(t){return"number"==typeof t?this.rightShiftS(t):this.rightShiftM(t)},t.prototype.rightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t);return this},t.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t.get(e,r));return this},t.rightShift=function(t,r){return new e(t).rightShift(r)},t.prototype.zeroFillRightShift=t.prototype.rightShift,t.prototype.zeroFillRightShiftS=t.prototype.rightShiftS,t.prototype.zeroFillRightShiftM=t.prototype.rightShiftM,t.zeroFillRightShift=t.rightShift,t.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,~this.get(t,e));return this},t.not=function(t){return new e(t).not()},t.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.abs(this.get(t,e)));return this},t.abs=function(t){return new e(t).abs()},t.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acos(this.get(t,e)));return this},t.acos=function(t){return new e(t).acos()},t.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acosh(this.get(t,e)));return this},t.acosh=function(t){return new e(t).acosh()},t.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asin(this.get(t,e)));return this},t.asin=function(t){return new e(t).asin()},t.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asinh(this.get(t,e)));return this},t.asinh=function(t){return new e(t).asinh()},t.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atan(this.get(t,e)));return this},t.atan=function(t){return new e(t).atan()},t.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atanh(this.get(t,e)));return this},t.atanh=function(t){return new e(t).atanh()},t.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cbrt(this.get(t,e)));return this},t.cbrt=function(t){return new e(t).cbrt()},t.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.ceil(this.get(t,e)));return this},t.ceil=function(t){return new e(t).ceil()},t.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.clz32(this.get(t,e)));return this},t.clz32=function(t){return new e(t).clz32()},t.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cos(this.get(t,e)));return this},t.cos=function(t){return new e(t).cos()},t.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cosh(this.get(t,e)));return this},t.cosh=function(t){return new e(t).cosh()},t.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.exp(this.get(t,e)));return this},t.exp=function(t){return new e(t).exp()},t.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.expm1(this.get(t,e)));return this},t.expm1=function(t){return new e(t).expm1()},t.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.floor(this.get(t,e)));return this},t.floor=function(t){return new e(t).floor()},t.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.fround(this.get(t,e)));return this},t.fround=function(t){return new e(t).fround()},t.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log(this.get(t,e)));return this},t.log=function(t){return new e(t).log()},t.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log1p(this.get(t,e)));return this},t.log1p=function(t){return new e(t).log1p()},t.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log10(this.get(t,e)));return this},t.log10=function(t){return new e(t).log10()},t.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log2(this.get(t,e)));return this},t.log2=function(t){return new e(t).log2()},t.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.round(this.get(t,e)));return this},t.round=function(t){return new e(t).round()},t.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sign(this.get(t,e)));return this},t.sign=function(t){return new e(t).sign()},t.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sin(this.get(t,e)));return this},t.sin=function(t){return new e(t).sin()},t.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sinh(this.get(t,e)));return this},t.sinh=function(t){return new e(t).sinh()},t.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sqrt(this.get(t,e)));return this},t.sqrt=function(t){return new e(t).sqrt()},t.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tan(this.get(t,e)));return this},t.tan=function(t){return new e(t).tan()},t.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tanh(this.get(t,e)));return this},t.tanh=function(t){return new e(t).tanh()},t.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.trunc(this.get(t,e)));return this},t.trunc=function(t){return new e(t).trunc()},t.pow=function(t,r){return new e(t).pow(r)},t.prototype.pow=function(t){return"number"==typeof t?this.powS(t):this.powM(t)},t.prototype.powS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.pow(this.get(e,r),t));return this},t.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.pow(this.get(e,r),t.get(e,r)));return this}}(z,j);class C extends z{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}}class q{constructor(t){let e,r,o,s,n,i,l,h,u,a=(t=C.checkMatrix(t)).clone(),f=a.rows,c=a.columns,m=new Float64Array(f),g=1;for(e=0;e<f;e++)m[e]=e;for(h=new Float64Array(f),r=0;r<c;r++){for(e=0;e<f;e++)h[e]=a.get(e,r);for(e=0;e<f;e++){for(u=Math.min(e,r),n=0,o=0;o<u;o++)n+=a.get(e,o)*h[o];h[e]-=n,a.set(e,r,h[e])}for(s=r,e=r+1;e<f;e++)Math.abs(h[e])>Math.abs(h[s])&&(s=e);if(s!==r){for(o=0;o<c;o++)i=a.get(s,o),a.set(s,o,a.get(r,o)),a.set(r,o,i);l=m[s],m[s]=m[r],m[r]=l,g=-g}if(r<f&&0!==a.get(r,r))for(e=r+1;e<f;e++)a.set(e,r,a.get(e,r)/a.get(r,r))}this.LU=a,this.pivotVector=m,this.pivotSign=g}isSingular(){let t=this.LU,e=t.columns;for(let r=0;r<e;r++)if(0===t.get(r,r))return!0;return!1}solve(t){t=j.checkMatrix(t);let e=this.LU;if(e.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let r,o,s,n=t.columns,i=t.subMatrixRow(this.pivotVector,0,n-1),l=e.columns;for(s=0;s<l;s++)for(r=s+1;r<l;r++)for(o=0;o<n;o++)i.set(r,o,i.get(r,o)-i.get(s,o)*e.get(r,s));for(s=l-1;s>=0;s--){for(o=0;o<n;o++)i.set(s,o,i.get(s,o)/e.get(s,s));for(r=0;r<s;r++)for(o=0;o<n;o++)i.set(r,o,i.get(r,o)-i.get(s,o)*e.get(r,s))}return i}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,r=t.columns;for(let o=0;o<r;o++)e*=t.get(o,o);return e}get lowerTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,o=new j(e,r);for(let s=0;s<e;s++)for(let e=0;e<r;e++)s>e?o.set(s,e,t.get(s,e)):s===e?o.set(s,e,1):o.set(s,e,0);return o}get upperTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,o=new j(e,r);for(let s=0;s<e;s++)for(let e=0;e<r;e++)s<=e?o.set(s,e,t.get(s,e)):o.set(s,e,0);return o}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function D(t,e){let r=0;return Math.abs(t)>Math.abs(e)?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):0!==e?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):0}class P{constructor(t){let e,r,o,s,n=(t=C.checkMatrix(t)).clone(),i=t.rows,l=t.columns,h=new Float64Array(l);for(o=0;o<l;o++){let t=0;for(e=o;e<i;e++)t=D(t,n.get(e,o));if(0!==t){for(n.get(o,o)<0&&(t=-t),e=o;e<i;e++)n.set(e,o,n.get(e,o)/t);for(n.set(o,o,n.get(o,o)+1),r=o+1;r<l;r++){for(s=0,e=o;e<i;e++)s+=n.get(e,o)*n.get(e,r);for(s=-s/n.get(o,o),e=o;e<i;e++)n.set(e,r,n.get(e,r)+s*n.get(e,o))}}h[o]=-t}this.QR=n,this.Rdiag=h}solve(t){t=j.checkMatrix(t);let e=this.QR,r=e.rows;if(t.rows!==r)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let o,s,n,i,l=t.columns,h=t.clone(),u=e.columns;for(n=0;n<u;n++)for(s=0;s<l;s++){for(i=0,o=n;o<r;o++)i+=e.get(o,n)*h.get(o,s);for(i=-i/e.get(n,n),o=n;o<r;o++)h.set(o,s,h.get(o,s)+i*e.get(o,n))}for(n=u-1;n>=0;n--){for(s=0;s<l;s++)h.set(n,s,h.get(n,s)/this.Rdiag[n]);for(o=0;o<n;o++)for(s=0;s<l;s++)h.set(o,s,h.get(o,s)-h.get(n,s)*e.get(o,n))}return h.subMatrix(0,u-1,0,l-1)}isFullRank(){let t=this.QR.columns;for(let e=0;e<t;e++)if(0===this.Rdiag[e])return!1;return!0}get upperTriangularMatrix(){let t,e,r=this.QR,o=r.columns,s=new j(o,o);for(t=0;t<o;t++)for(e=0;e<o;e++)t<e?s.set(t,e,r.get(t,e)):t===e?s.set(t,e,this.Rdiag[t]):s.set(t,e,0);return s}get orthogonalMatrix(){let t,e,r,o,s=this.QR,n=s.rows,i=s.columns,l=new j(n,i);for(r=i-1;r>=0;r--){for(t=0;t<n;t++)l.set(t,r,0);for(l.set(r,r,1),e=r;e<i;e++)if(0!==s.get(r,r)){for(o=0,t=r;t<n;t++)o+=s.get(t,r)*l.get(t,e);for(o=-o/s.get(r,r),t=r;t<n;t++)l.set(t,e,l.get(t,e)+o*s.get(t,r))}}return l}}class L{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(t=C.checkMatrix(t)).rows,o=t.columns;const{computeLeftSingularVectors:s=!0,computeRightSingularVectors:n=!0,autoTranspose:i=!1}=e;let l,h=Boolean(s),u=Boolean(n),a=!1;if(r<o)if(i){l=t.transpose(),r=l.rows,o=l.columns,a=!0;let e=h;h=u,u=e}else l=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else l=t.clone();let f=Math.min(r,o),c=Math.min(r+1,o),m=new Float64Array(c),g=new j(r,f),w=new j(o,o),p=new Float64Array(o),d=new Float64Array(r),y=new Float64Array(c);for(let t=0;t<c;t++)y[t]=t;let b=Math.min(r-1,o),M=Math.max(0,Math.min(o-2,r)),x=Math.max(b,M);for(let t=0;t<x;t++){if(t<b){m[t]=0;for(let e=t;e<r;e++)m[t]=D(m[t],l.get(e,t));if(0!==m[t]){l.get(t,t)<0&&(m[t]=-m[t]);for(let e=t;e<r;e++)l.set(e,t,l.get(e,t)/m[t]);l.set(t,t,l.get(t,t)+1)}m[t]=-m[t]}for(let e=t+1;e<o;e++){if(t<b&&0!==m[t]){let o=0;for(let s=t;s<r;s++)o+=l.get(s,t)*l.get(s,e);o=-o/l.get(t,t);for(let s=t;s<r;s++)l.set(s,e,l.get(s,e)+o*l.get(s,t))}p[e]=l.get(t,e)}if(h&&t<b)for(let e=t;e<r;e++)g.set(e,t,l.get(e,t));if(t<M){p[t]=0;for(let e=t+1;e<o;e++)p[t]=D(p[t],p[e]);if(0!==p[t]){p[t+1]<0&&(p[t]=0-p[t]);for(let e=t+1;e<o;e++)p[e]/=p[t];p[t+1]+=1}if(p[t]=-p[t],t+1<r&&0!==p[t]){for(let e=t+1;e<r;e++)d[e]=0;for(let e=t+1;e<r;e++)for(let r=t+1;r<o;r++)d[e]+=p[r]*l.get(e,r);for(let e=t+1;e<o;e++){let o=-p[e]/p[t+1];for(let s=t+1;s<r;s++)l.set(s,e,l.get(s,e)+o*d[s])}}if(u)for(let e=t+1;e<o;e++)w.set(e,t,p[e])}}let v=Math.min(o,r+1);if(b<o&&(m[b]=l.get(b,b)),r<v&&(m[v-1]=0),M+1<v&&(p[M]=l.get(M,v-1)),p[v-1]=0,h){for(let t=b;t<f;t++){for(let e=0;e<r;e++)g.set(e,t,0);g.set(t,t,1)}for(let t=b-1;t>=0;t--)if(0!==m[t]){for(let e=t+1;e<f;e++){let o=0;for(let s=t;s<r;s++)o+=g.get(s,t)*g.get(s,e);o=-o/g.get(t,t);for(let s=t;s<r;s++)g.set(s,e,g.get(s,e)+o*g.get(s,t))}for(let e=t;e<r;e++)g.set(e,t,-g.get(e,t));g.set(t,t,1+g.get(t,t));for(let e=0;e<t-1;e++)g.set(e,t,0)}else{for(let e=0;e<r;e++)g.set(e,t,0);g.set(t,t,1)}}if(u)for(let t=o-1;t>=0;t--){if(t<M&&0!==p[t])for(let e=t+1;e<o;e++){let r=0;for(let s=t+1;s<o;s++)r+=w.get(s,t)*w.get(s,e);r=-r/w.get(t+1,t);for(let s=t+1;s<o;s++)w.set(s,e,w.get(s,e)+r*w.get(s,t))}for(let e=0;e<o;e++)w.set(e,t,0);w.set(t,t,1)}let E=v-1,S=Number.EPSILON;for(;v>0;){let t,e;for(t=v-2;t>=-1&&-1!==t;t--){const e=Number.MIN_VALUE+S*Math.abs(m[t]+Math.abs(m[t+1]));if(Math.abs(p[t])<=e||Number.isNaN(p[t])){p[t]=0;break}}if(t===v-2)e=4;else{let r;for(r=v-1;r>=t&&r!==t;r--){let e=(r!==v?Math.abs(p[r]):0)+(r!==t+1?Math.abs(p[r-1]):0);if(Math.abs(m[r])<=S*e){m[r]=0;break}}r===t?e=3:r===v-1?e=1:(e=2,t=r)}switch(t++,e){case 1:{let e=p[v-2];p[v-2]=0;for(let r=v-2;r>=t;r--){let s=D(m[r],e),n=m[r]/s,i=e/s;if(m[r]=s,r!==t&&(e=-i*p[r-1],p[r-1]=n*p[r-1]),u)for(let t=0;t<o;t++)s=n*w.get(t,r)+i*w.get(t,v-1),w.set(t,v-1,-i*w.get(t,r)+n*w.get(t,v-1)),w.set(t,r,s)}break}case 2:{let e=p[t-1];p[t-1]=0;for(let o=t;o<v;o++){let s=D(m[o],e),n=m[o]/s,i=e/s;if(m[o]=s,e=-i*p[o],p[o]=n*p[o],h)for(let e=0;e<r;e++)s=n*g.get(e,o)+i*g.get(e,t-1),g.set(e,t-1,-i*g.get(e,o)+n*g.get(e,t-1)),g.set(e,o,s)}break}case 3:{const e=Math.max(Math.abs(m[v-1]),Math.abs(m[v-2]),Math.abs(p[v-2]),Math.abs(m[t]),Math.abs(p[t])),s=m[v-1]/e,n=m[v-2]/e,i=p[v-2]/e,l=m[t]/e,a=p[t]/e,f=((n+s)*(n-s)+i*i)/2,c=s*i*(s*i);let d=0;0===f&&0===c||(d=f<0?0-Math.sqrt(f*f+c):Math.sqrt(f*f+c),d=c/(f+d));let y=(l+s)*(l-s)+d,b=l*a;for(let e=t;e<v-1;e++){let s=D(y,b);0===s&&(s=Number.MIN_VALUE);let n=y/s,i=b/s;if(e!==t&&(p[e-1]=s),y=n*m[e]+i*p[e],p[e]=n*p[e]-i*m[e],b=i*m[e+1],m[e+1]=n*m[e+1],u)for(let t=0;t<o;t++)s=n*w.get(t,e)+i*w.get(t,e+1),w.set(t,e+1,-i*w.get(t,e)+n*w.get(t,e+1)),w.set(t,e,s);if(s=D(y,b),0===s&&(s=Number.MIN_VALUE),n=y/s,i=b/s,m[e]=s,y=n*p[e]+i*m[e+1],m[e+1]=-i*p[e]+n*m[e+1],b=i*p[e+1],p[e+1]=n*p[e+1],h&&e<r-1)for(let t=0;t<r;t++)s=n*g.get(t,e)+i*g.get(t,e+1),g.set(t,e+1,-i*g.get(t,e)+n*g.get(t,e+1)),g.set(t,e,s)}p[v-2]=y;break}case 4:if(m[t]<=0&&(m[t]=m[t]<0?-m[t]:0,u))for(let e=0;e<=E;e++)w.set(e,t,-w.get(e,t));for(;t<E&&!(m[t]>=m[t+1]);){let e=m[t];if(m[t]=m[t+1],m[t+1]=e,u&&t<o-1)for(let r=0;r<o;r++)e=w.get(r,t+1),w.set(r,t+1,w.get(r,t)),w.set(r,t,e);if(h&&t<r-1)for(let o=0;o<r;o++)e=g.get(o,t+1),g.set(o,t+1,g.get(o,t)),g.set(o,t,e);t++}v--}}if(a){let t=w;w=g,g=t}this.m=r,this.n=o,this.s=m,this.U=g,this.V=w}solve(t){let e=t,r=this.threshold,o=this.s.length,s=j.zeros(o,o);for(let t=0;t<o;t++)Math.abs(this.s[t])<=r?s.set(t,t,0):s.set(t,t,1/this.s[t]);let n=this.U,i=this.rightSingularVectors,l=i.mmul(s),h=i.rows,u=n.rows,a=j.zeros(h,u);for(let t=0;t<h;t++)for(let e=0;e<u;e++){let r=0;for(let s=0;s<o;s++)r+=l.get(t,s)*n.get(e,s);a.set(t,e,r)}return a.mmul(e)}solveForDiagonal(t){return this.solve(j.diag(t))}inverse(){let t=this.V,e=this.threshold,r=t.rows,o=t.columns,s=new j(r,this.s.length);for(let n=0;n<r;n++)for(let r=0;r<o;r++)Math.abs(this.s[r])>e&&s.set(n,r,t.get(n,r)/this.s[r]);let n=this.U,i=n.rows,l=n.columns,h=new j(r,i);for(let t=0;t<r;t++)for(let e=0;e<i;e++){let r=0;for(let o=0;o<l;o++)r+=s.get(t,o)*n.get(e,o);h.set(t,e,r)}return h}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,r=this.s;for(let o=0,s=r.length;o<s;o++)r[o]>t&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return j.diag(this.s)}}function O(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t=C.checkMatrix(t),e?new L(t).inverse():function(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t=C.checkMatrix(t),e=C.checkMatrix(e),r?new L(t).solve(e):t.isSquare()?new q(t).solve(e):new P(t).solve(e)}(t,j.eye(t.rows))}function U(t,e,r,o,s){let n=r*o*o,i=j.eye(e.length,e.length,n);const l=s(e);let h=new Float64Array(t.x.length);for(let e=0;e<t.x.length;e++)h[e]=l(t.x[e]);let u=function(t,e,r,o,s){const n=r.length,i=t.x.length;let l=new Array(n);for(let h=0;h<n;h++){l[h]=new Array(i);let n=r.slice();n[h]+=o;let u=s(n);for(let r=0;r<i;r++)l[h][r]=e[r]-u(t.x[r])}return new j(l)}(t,h,e,o,s),a=function(t,e){const r=t.x.length;let o=new Array(r);for(let s=0;s<r;s++)o[s]=[t.y[s]-e[s]];return new j(o)}(t,h),f=O(i.add(u.mmul(u.transpose())));return(e=(e=new j([e])).sub(f.mmul(u).mmul(a).mul(o).transpose())).to1DArray()}function _(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{maxIterations:o=100,gradientDifference:s=.1,damping:n=0,errorTolerance:i=.01,minValues:l,maxValues:h,initialValues:u}=r;if(n<=0)throw new Error("The damping option must be a positive number");if(!t.x||!t.y)throw new Error("The data parameter must have x and y elements");if(!a(t.x)||t.x.length<2||!a(t.y)||t.y.length<2)throw new Error("The data parameter elements must be an array with more than 2 points");if(t.x.length!==t.y.length)throw new Error("The data parameter elements must have the same size");let c=u||new Array(e.length).fill(1),m=c.length;if(h=h||new Array(m).fill(Number.MAX_SAFE_INTEGER),l=l||new Array(m).fill(Number.MIN_SAFE_INTEGER),h.length!==l.length)throw new Error("minValues and maxValues must be the same size");if(!a(c))throw new Error("initialValues must be an array");let g,w=f(t,c,e),p=w<=i;for(g=0;g<o&&!p;g++){c=U(t,c,n,s,e);for(let t=0;t<m;t++)c[t]=Math.min(Math.max(l[t],c[t]),h[t]);if(w=f(t,c,e),isNaN(w))break;p=w<=i}return{parameterValues:c,parameterError:w,iterations:g}}function W(t){return function(e){let r,o=t.length/3,s=e.length,n=void 0===s?0:new Float64Array(s).fill(0);for(let i=0;i<o;i++)if(r=2*Math.pow(t[i+2*o],2),void 0===s)n+=t[i+o]*Math.exp(-Math.pow(e-t[i],2)/r);else for(let l=0;l<s;l++)n[l]+=t[i+o]*Math.exp(-Math.pow(e[l]-t[i],2)/r);return n}}function Q(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t[0],s=t[1],n=Math.max(...s);s.forEach((t,e,r)=>r[e]/=n);let i=e.length,l=new Float64Array(3*i),h=new Float64Array(3*i),u=new Float64Array(3*i),a=Math.abs(o[0]-o[1]);for(let t=0;t<i;t++)l[t]=e[t].x,l[t+i]=e[t].y/n,l[t+2*i]=e[t].width,h[t]=e[t].x-a,h[t+i]=0,h[t+2*i]=e[t].width/4,u[t]=e[t].x+a,u[t+i]=1.2*e[t].y/n,u[t+2*i]=4*e[t].width;let f={x:o,y:s},c=new Array(i),m={damping:1.5,initialValues:l,minValues:h,maxValues:u,gradientDifference:a/1e4,maxIterations:100,errorTolerance:1e-4};r=Object.assign({},m,r);let g=_(f,W,r);for(let t=0;t<i;t++)c[t]={parameters:[g.parameterValues[t],g.parameterValues[t+i]*n,g.parameterValues[t+2*i]],error:g.parameterError};return c}function G(t){return function(e){let r=t[2]*t[2]/2;if(!e.length)return t[1]*Math.exp(-(e-t[0])*(e-t[0])/r);let o=new Float64Array(e.length);for(let s=0;s<e.length;s++)o[s]=t[1]*Math.exp(-(e[s]-t[0])*(e[s]-t[0])/r);return o}}function X(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t[0],s=t[1],n=Math.max(...s);s.forEach((t,e,r)=>r[e]/=n);let i=Math.abs(o[0]-o[1]),l={x:o,y:s},h={damping:1.5,initialValues:new Float64Array([e.x,1,e.width]),minValues:new Float64Array([e.x-i,0,e.width/4]),maxValues:new Float64Array([e.x+i,1.25,4*e.width]),gradientDifference:i/1e4,maxIterations:100,errorTolerance:1e-4};r=Object.assign({},h,r);let u=_(l,G,r);return{parameters:[u.parameterValues[0],u.parameterValues[1]*n,u.parameterValues[2]],error:u.parameterError}}function B(t){return function(e){let r,o,s=t.length/3,n=e.length,i=void 0===n?0:new Float64Array(n).fill(0);for(let l=0;l<s;l++)if(o=Math.pow(t[l+2*s]/2,2),r=t[l+s]*o,void 0===n)i+=r/(Math.pow(e-t[l],2)+o);else for(let s=0;s<n;s++)i[s]+=r/(Math.pow(e[s]-t[l],2)+o);return i}}function Y(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t[0],s=t[1],n=Math.max(...s);s.forEach((t,e,r)=>r[e]/=n);let i=e.length,l=new Float64Array(3*i),h=new Float64Array(3*i),u=new Float64Array(3*i),a=Math.abs(o[0]-o[1]);for(let t=0;t<i;t++)l[t]=e[t].x,l[t+i]=1,l[t+2*i]=e[t].width,h[t]=e[t].x-a,h[t+i]=0,h[t+2*i]=e[t].width/4,u[t]=e[t].x+a,u[t+i]=1.5,u[t+2*i]=4*e[t].width;let f={x:o,y:s},c=new Array(i),m={damping:1.5,initialValues:l,minValues:h,maxValues:u,gradientDifference:a/1e4,maxIterations:100,errorTolerance:1e-4};r=Object.assign({},m,r);let g=_(f,B,r);for(let t=0;t<i;t++)c[t]={parameters:[g.parameterValues[t],g.parameterValues[t+i]*n,g.parameterValues[t+2*i]],error:g.parameterError};return c}function J(t){return function(e){let r=t[1]*Math.pow(t[2]/2,2),o=e.length;if(!o)return r/(Math.pow(e-t[0],2)+Math.pow(t[2]/2,2));let s=new Float64Array(o);for(let n=0;n<o;n++)s[n]=r/(Math.pow(e[n]-t[0],2)+Math.pow(t[2]/2,2));return s}}function H(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t[0],s=t[1],n=Math.max(...s);s.forEach((t,e,r)=>r[e]/=n);let i=Math.abs(o[0]-o[1]),l={x:o,y:s},h={damping:1.5,initialValues:new Float64Array([e.x,1,e.width]),minValues:new Float64Array([e.x-i,.75,e.width/4]),maxValues:new Float64Array([e.x+i,1.25,4*e.width]),gradientDifference:i/1e4,maxIterations:100,errorTolerance:1e-4};r=Object.assign({},h,r);let u=_(l,J,r);return{parameters:[u.parameterValues[0],u.parameterValues[1]*n,u.parameterValues[2]],error:u.parameterError}}function K(t,e,r,o,s){let n=r.length,i=[],l=[],h=Math.sign(r[1]-r[0]);-1===h&&(s[0]=r.length-1);let u=Math.abs(e-t)/2,a=(t+e)/2,f=!1,c=s[0];for(;!f&&c<n&&c>=0;)Math.abs(r[c]-a)<=u?(i.push(r[c]),l.push(o[c]),c+=h):1===Math.sign(a-r[c])?c+=h:f=!0;return s[0]=c,[i,l]}t.broadenPeaks=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{factor:r=2,overlap:o=!1}=e;for(let e of t)e.right&&e.left?(e.from=e.x-(e.x-e.left.x)*r,e.to=e.x+(e.right.x-e.x)*r):(e.from=e.x-e.width/2*r,e.to=e.x+e.width/2*r);if(!o)for(let e=0;e<t.length-1;e++){let r=t[e],o=t[e+1];r.to>o.from&&(r.to=o.from=(r.to+o.from)/2)}for(let e of t)e.width=e.to-e.from;return t},t.gsd=function(t,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{noiseLevel:s,sgOptions:n={windowSize:9,polynomial:3},smoothY:u=!0,heightFactor:a=0,broadRatio:f=0,maxCriteria:c=!0,minMaxRatio:m=25e-5,derivativeThreshold:g=-1,realTopDetection:w=!1}=o;const p=r.slice();let d=i(t);void 0===s&&(s=d?l(p):0);const y={m:1,b:s};c||(y.m=-1,y.b*=-1);for(let t=0;t<p.length;t++)p[t]=y.m*p[t]-y.b;for(let t=0;t<p.length;t++)p[t]<0&&(p[t]=0);let b,M,x=p;const{windowSize:v,polynomial:E}=n;d?(u&&(x=e(p,t[1]-t[0],{windowSize:v,polynomial:E,derivative:0})),b=e(p,t[1]-t[0],{windowSize:v,polynomial:E,derivative:1}),M=e(p,t[1]-t[0],{windowSize:v,polynomial:E,derivative:2})):(u&&(x=e(p,t,{windowSize:v,polynomial:E,derivative:0})),b=e(p,t,{windowSize:v,polynomial:E,derivative:1}),M=e(p,t,{windowSize:v,polynomial:E,derivative:2}));const S=t,A=t[1]-t[0];let R=0,V=0;for(let t=0;t<x.length;t++)Math.abs(M[t])>R&&(R=Math.abs(M[t])),Math.abs(x[t])>V&&(V=Math.abs(x[t]));let T=null,k=null,F=new Array(x.length-2),N=new Array(x.length),z=new Array(x.length),I=new Array(x.length-2),j=0,C=0,q=0,D=0;for(let t=1;t<x.length-1;++t)Math.abs(b[t])>g&&((b[t]<b[t-1]&&b[t]<=b[t+1]||b[t]<=b[t-1]&&b[t]<b[t+1])&&(k={x:S[t],index:t},A>0&&null!==T&&(N[C++]=T,z[q++]=k)),(b[t]>=b[t-1]&&b[t]>b[t+1]||b[t]>b[t-1]&&b[t]>=b[t+1])&&(T={x:S[t],index:t},A<0&&null!==k&&(N[C++]=T,z[q++]=k))),M[t]<M[t-1]&&M[t]<M[t+1]&&(F[j++]=t,I[D++]=Math.abs(M[t])<=f*R);F.length=j,N.length=C,z.length=q,I.length=D;let P,L,O,U,_,W=new Array(F.length),Q=0,G=-1;for(let t=0;t<F.length;++t){L=S[F[t]],P=-1;let e=G+1;for(U=Number.MAX_VALUE,O=0,_=!0;-1===P&&e<N.length&&_;)O=Math.abs(L-(N[e].x+z[e].x)/2),O<U?U=O:_=!1,O<Math.abs(N[e].x-z[e].x)/2&&(P=e,G=e),++e;if(-1!==P&&Math.abs(x[F[t]])>m*V&&(W[Q++]={index:F[t],x:L,y:(x[F[t]]+y.b)/y.m,width:Math.abs(z[P].x-N[P].x),soft:I[t]},W[Q-1].left=N[P],W[Q-1].right=z[P],a)){let t=x[N[P].index],e=x[z[P].index];W[Q-1].height=a*(W[Q-1].y-(t+e)/2)}}W.length=Q,w&&h(W,S,x);for(let t=0;t<W.length;t++)W[t].base=s;return W.sort((function(t,e){return t.x-e.x})),W},t.joinBroadPeaks=function(t){let e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).width,r=[],o=0,s=0,n=1;for(let e=t.length-1;e>=0;e--)t[e].soft&&r.push(t.splice(e,1)[0]);r.push({x:Number.MAX_VALUE});let i=[[r[0].x,r[0].y]],l=[r[0].index];for(let h=1;h<r.length;h++)if(Math.abs(r[h-1].x-r[h].x)<e)i.push([r[h].x,r[h].y]),r[h].y>o&&(o=r[h].y,s=h),l.push(r[h].index),n++;else{if(n>2){let e=H(i,{x:r[s].x,y:o,width:Math.abs(i[0][0]-i[i.length-1][0])}),{parameters:n}=e;t.push({x:n[0],y:n[1],width:n[2],index:Math.floor(l.reduce((t,e)=>t+e,0)/l.length),soft:!1})}else l.forEach(e=>{t.push(r[e])});i=[[r[h].x,r[h].y]],l=[h],o=r[h].y,s=h,n=1}return t.sort((function(t,e){return t.x-e.x})),t},t.optimizePeaks=function(t,e,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{functionName:s="gaussian",factorWidth:n=4,optimizationOptions:i={damping:1.5,maxIterations:100,errorTolerance:1e-4}}=o;let l,h=[0],u=function(t,e){let r,o,s=[],n=[],i=[t[0].x,e*t[0].width];for(let l=0;l<t.length;l++)Math.abs(t[l].x-i[0])<e*t[l].width+i[1]?(s.push(t[l]),r=i[0]+i[1],t[l].x+e*t[l].width>r&&(r=t[l].x+e*t[l].width),o=i[0]-i[1],t[l].x-e*t[l].width<o&&(o=t[l].x-e*t[l].width),i=[(r+o)/2,Math.abs(r-o)/2]):(n.push({limits:i,group:s}),s=[t[l]],i=[t[l].x,e*t[l].width]);n.push({limits:i,group:s});for(let t=n.length-2;t>=0;t--)if(Math.abs(n[t].limits[0]-n[t+1].limits[0])<(n[t].limits[1]+n[t+1].limits[1])/2){for(let e=0;e<n[t+1].group.length;e++)n[t].group.push(n[t+1].group[e]);r=n[t].limits[0]+n[t].limits[1],n[t+1].limits[0]+n[t+1].limits[1]>r&&(r=n[t+1].limits[0]+n[t+1].limits[1]),o=n[t].limits[0]-n[t].limits[1],n[t+1].limits[0]-n[t+1].limits[1]<o&&(o=n[t+1].limits[0]-n[t+1].limits[1]),n[t].limits=[(r+o)/2,Math.abs(r-o)/2],n.splice(t+1,1)}return n}(t,n),a=[],f=1;"gaussian"===s&&(f=1.17741);for(let t=0;t<u.length;t++){let o=u[t].group;if(o.length>1){if(l=K(u[t].limits[0]-u[t].limits[1],u[t].limits[0]+u[t].limits[1],e,r,h),l[0].length>5){let t=[];"gaussian"===s?t=Q(l,o,i):"lorentzian"===s&&(t=Y(l,o,i));for(let e=0;e<t.length;e++){let{parameters:r}=t[e];a.push({x:r[0],y:r[1],width:r[2]*f,index:o[e].index})}}}else if(o=o[0],l=K(o.x-n*o.width,o.x+n*o.width,e,r,h),l[0].length>5){let t=[];"gaussian"===s?t=X([l[0],l[1]],o,i):"lorentzian"===s&&(t=H([l[0],l[1]],o,i));let{parameters:e}=t;a.push({x:e[0],y:e[1],width:e[2]*f,index:o.index})}}return a},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ml-gsd.min.js.map
